<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IELTS Wizard â€” Apple Minimal</title>

  <!-- MDBootstrap -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.3.0/mdb.min.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.3.0/mdb.min.js" defer></script>

  <!-- Confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js" defer></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --sky:#78b9ff;
      --royal:#0466d6;
      --grad: linear-gradient(135deg,var(--sky),var(--royal));
      --card-bg: #ffffff;
      --muted:#6b6b6b;
    }
    html,body{height:100%;}
    body{
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      margin:0;
      background: #ffffff;
      color:#111;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* centered container */
    .center-wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px;}

    /* minimal card */
    .minimal-card{
      width:100%;max-width:980px;background:var(--card-bg);
      border-radius:14px;border:1px solid #eef3ff;padding:28px;
      box-shadow: 0 10px 30px rgba(30,60,100,0.06);
    }

    .brand {
      display:flex;gap:12px;align-items:center;margin-bottom:6px;
    }
    .brand-badge{
      width:48px;height:48px;border-radius:10px;background:var(--grad);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;
      box-shadow: 0 6px 18px rgba(4,102,214,0.16);
    }
    .brand-title{font-weight:700;font-size:1.15rem;color:#0b2340;}

    /* login */
    .login-row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
    input[type="password"]{border-radius:10px;padding:12px;border:1px solid #e6eefc;box-shadow:none;}

    .blue-btn{
      background:var(--grad);color:white;border:none;padding:10px 20px;border-radius:10px;font-weight:700;
      box-shadow: 0 8px 20px rgba(4,102,214,0.12);
    }
    .blue-btn:active{transform:translateY(1px);}

    /* wizard layout */
    .wizard{margin-top:18px;}
    .step-nav{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:16px;}
    .step-pill{padding:8px 12px;border-radius:999px;background:#f6fbff;border:1px solid #e7f1ff;color:#0b2340;font-weight:600;}
    .step-pill.active{background:var(--grad);color:white;box-shadow: 0 8px 24px rgba(4,102,214,0.12);}

    .step-card{background:#fbfeff;border-radius:12px;padding:18px;border:1px solid #eef6ff;}
    .glass-lite{border-radius:10px;padding:14px;border:1px solid #eef6ff;background:#fff;}

    .timer-display{font-weight:800;color:var(--royal);font-size:1.35rem;}

    .vocab-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;}
    .vocab-item{padding:10px;border-radius:8px;border:1px solid #eef6ff;background:#fff;display:flex;justify-content:space-between;align-items:center;gap:8px;}

    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:0.9rem;padding-bottom:12px;}
    @media (max-width:720px){ .minimal-card{padding:18px;} }
  </style>
</head>
<body>

  <div class="center-wrap">
    <div class="minimal-card" id="appCard">
      <div class="brand">
        <div class="brand-badge">IELTS</div>
        <div>
          <div class="brand-title">IELTS Premium â€” Classroom Mode</div>
          <div style="font-size:0.9rem;color:var(--muted);">Apple Minimal â€” White & Gradient Blue</div>
        </div>
      </div>

      <!-- LOGIN -->
      <div id="loginScreen">
        <div style="margin-top:12px;">
          <h2 style="margin:0 0 8px 0;">Enter Access Code</h2>
          <div style="color:var(--muted);margin-bottom:12px;">Please enter password to open the lesson (masked).</div>

          <div class="login-row">
            <input id="pw" type="password" placeholder="Enter password" style="flex:1;min-width:220px;">
            <button id="pwBtn" class="blue-btn">Open</button>
          </div>

          <div id="pwError" style="color:#e04b4b;margin-top:10px;display:none;">Incorrect access code</div>
        </div>
      </div>

      <!-- WIZARD (hidden until login) -->
      <div id="wizard" style="display:none;margin-top:18px;">
        <div class="step-nav" id="stepNav"></div>

        <div id="stepArea" class="step-card">
          <!-- content injected via JS -->
        </div>

        <div style="display:flex;justify-content:space-between;gap:10px;margin-top:12px;flex-wrap:wrap;">
          <button id="prevBtn" class="blue-btn" style="background:#e9f2ff;color:var(--royal);border:1px solid #cfe7ff;box-shadow:none;" disabled>Prev</button>
          <div style="display:flex;gap:8px;">
            <button id="homeBtn" class="blue-btn" style="background:transparent;color:var(--royal);border:1px solid #e7f1ff;box-shadow:none;display:none;">Home</button>
            <button id="nextBtn" class="blue-btn">Next</button>
          </div>
        </div>
      </div>

      <footer>Â© 2025 IELTS â€” Classroom Mode</footer>
    </div>
  </div>

<script>
  // ---------- state ----------
  const correctPassword = "VII I MMVI";
  let step = 1, total = 7;

  // DOM
  const pw = document.getElementById('pw'), pwBtn = document.getElementById('pwBtn'), pwError = document.getElementById('pwError');
  const loginScreen = document.getElementById('loginScreen'), wizard = document.getElementById('wizard');
  const stepArea = document.getElementById('stepArea'), stepNav = document.getElementById('stepNav');
  const prevBtn = document.getElementById('prevBtn'), nextBtn = document.getElementById('nextBtn'), homeBtn = document.getElementById('homeBtn');

  // initial setup
  function renderStepNav(){
    stepNav.innerHTML = '';
    for(let i=1;i<=total;i++){
      const el = document.createElement('div');
      el.className = 'step-pill' + (i===step? ' active':'');
      el.textContent = 'Step '+i;
      el.addEventListener('click', ()=>{ step = i; render(); });
      stepNav.appendChild(el);
    }
  }

  // ---------- login ----------
  pwBtn.addEventListener('click', ()=> {
    const v = pw.value.trim();
    if(v === correctPassword){
      loginScreen.style.display = 'none';
      wizard.style.display = 'block';
      render();
    } else {
      pwError.style.display = 'block';
      setTimeout(()=> pwError.style.display = 'none', 2200);
    }
  });
  pw.addEventListener('keyup', (e)=> { if(e.key==='Enter') pwBtn.click(); });

  // ---------- step content ----------
  // shared helpers
  function createAudio(src){ return '<audio controls class="w-100"><source src="'+src+'" type="audio/mpeg">Your browser does not support audio.</audio>'; }
  function createVideo(src){ return '<div class="ratio ratio-16x9"><video controls><source src="'+src+'" type="video/mp4">Your browser does not support video.</video></div>'; }

  // timer
  let timerS = 6*60, timerInt = null;
  function formatTime(s){ const m = String(Math.floor(s/60)).padStart(2,'0'); const r = String(s%60).padStart(2,'0'); return m+':'+r; }

  function render(){
    renderStepNav();
    prevBtn.disabled = (step===1);
    nextBtn.disabled = (step===total+1);
    let html = '';
    if(step===1){
      html = `
        <h3>Step 1 â€” Task Overview</h3>
        <p style="color:var(--muted)">Audio and video overview of the IELTS task.</p>
        <div class="glass-lite mb-3">${createAudio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3')}</div>
        <div class="glass-lite">${createVideo('https://sample-videos.com/video123/mp4/720/big_buck_bunny_720p_1mb.mp4')}</div>
      `;
    } else if(step===2){
      html = `
        <h3>Step 2 â€” Brainstorm</h3>
        <p style="color:var(--muted)">Task image & description. Use the 6-minute focus timer.</p>
        <img src="https://images.unsplash.com/photo-1503676260728-1c00da094a0b?auto=format&fit=crop&w=1200&q=80" style="width:100%;border-radius:10px;margin:12px 0;">
        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
          <div><div style="font-size:14px;color:var(--muted)">Timer</div><div class="timer-display" id="timerDisp">${formatTime(timerS)}</div></div>
          <div style="display:flex;gap:8px;margin-left:auto;">
            <button class="blue-btn" onclick="startTimer()">Start</button>
            <button class="blue-btn" style="background:#eef6ff;color:var(--royal)" onclick="pauseTimer()">Pause</button>
            <button class="blue-btn" style="background:#eef6ff;color:var(--royal)" onclick="resetTimer()">Reset</button>
          </div>
        </div>
        <div style="margin-top:12px;"><textarea id="brainNotes" rows="5" style="width:100%;border-radius:10px;border:1px solid #eef6ff;padding:10px" placeholder="Write ideas here..."></textarea></div>
      `;
    } else if(step===3){
      html = `
        <h3>Step 3 â€” Key Vocabulary</h3>
        <p style="color:var(--muted)">Pronounce words in chosen accent.</p>
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;">
          <select id="accent" style="padding:8px;border-radius:8px;border:1px solid #eef6ff;">
            <option value="en-GB">UK English</option>
            <option value="en-IN">Indian English</option>
            <option value="en-US">US English</option>
          </select>
          <input id="newWord" placeholder="New word" style="flex:1;padding:8px;border-radius:8px;border:1px solid #eef6ff;">
          <button class="blue-btn" onclick="addVocab()">Add</button>
        </div>
        <div class="vocab-grid" id="vocabGrid"></div>
      `;
    } else if(step===4){
      html = `
        <h3>Step 4 â€” Plan Intro & Conclusion</h3>
        <p style="color:var(--muted)">Use sample lines and insert into composer.</p>
        <div style="display:flex;gap:12px;flex-wrap:wrap;">
          <div style="flex:1;min-width:260px;" class="glass-lite">
            <strong>Introductions</strong>
            <ul style="padding-left:18px;margin-top:8px;color:var(--muted)">
              <li>Many people argue that ...</li>
              <li>It is often suggested that ...</li>
              <li>In recent years, ...</li>
            </ul>
            <button class="blue-btn" onclick="useIntro()">Use Intro</button>
          </div>
          <div style="flex:1;min-width:260px;" class="glass-lite">
            <strong>Conclusions</strong>
            <ul style="padding-left:18px;margin-top:8px;color:var(--muted)">
              <li>In conclusion, ...</li>
              <li>Overall, it seems that ...</li>
              <li>To sum up, ...</li>
            </ul>
            <button class="blue-btn" onclick="useConcl()">Use Concl</button>
          </div>
        </div>
        <div style="margin-top:12px;"><textarea id="introCompose" rows="4" style="width:100%;border-radius:10px;border:1px solid #eef6ff;padding:10px" placeholder="Intro & conclusion will appear here..."></textarea></div>
      `;
    } else if(step===5){
      html = `
        <h3>Step 5 â€” Body Paragraph 1</h3>
        <p style="color:var(--muted)">MR â†’ SR â†’ EX</p>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <input id="mr1" placeholder="Main Reason" style="flex:1;padding:10px;border-radius:8px;border:1px solid #eef6ff;">
          <input id="sr1" placeholder="Supporting Reason" style="flex:1;padding:10px;border-radius:8px;border:1px solid #eef6ff;">
          <input id="ex1" placeholder="Example" style="flex:1;padding:10px;border-radius:8px;border:1px solid #eef6ff;">
        </div>
        <div style="margin-top:10px;display:flex;gap:8px;">
          <button class="blue-btn" onclick="saveP1()">Save</button>
          <button class="blue-btn" style="background:#eef6ff;color:var(--royal)" onclick="copyP1()">Copy</button>
        </div>
        <div style="margin-top:10px;"><textarea id="preview1" rows="3" readonly style="width:100%;border-radius:8px;border:1px solid #eef6ff;padding:10px"></textarea></div>
      `;
    } else if(step===6){
      html = `
        <h3>Step 6 â€” Body Paragraph 2</h3>
        <p style="color:var(--muted)">MR â†’ SR â†’ EX (or counter-argument)</p>
        <div style="display:flex;gap:10px;flex-wrap:wrap;">
          <input id="mr2" placeholder="Main Reason" style="flex:1;padding:10px;border-radius:8px;border:1px solid #eef6ff;">
          <input id="sr2" placeholder="Supporting Reason" style="flex:1;padding:10px;border-radius:8px;border:1px solid #eef6ff;">
          <input id="ex2" placeholder="Example" style="flex:1;padding:10px;border-radius:8px;border:1px solid #eef6ff;">
        </div>
        <div style="margin-top:10px;display:flex;gap:8px;">
          <button class="blue-btn" onclick="saveP2()">Save</button>
          <button class="blue-btn" style="background:#eef6ff;color:var(--royal)" onclick="copyP2()">Copy</button>
        </div>
        <div style="margin-top:10px;"><textarea id="preview2" rows="3" readonly style="width:100%;border-radius:8px;border:1px solid #eef6ff;padding:10px"></textarea></div>
      `;
    } else if(step===7){
      const p1 = localStorage.getItem('p1') || '';
      const p2 = localStorage.getItem('p2') || '';
      html = `
        <h3>Step 7 â€” Final Review & Completion</h3>
        <p style="color:var(--muted)">Review the response. Mark complete when ready.</p>
        <textarea id="fullPreview" rows="8" readonly style="width:100%;border-radius:8px;border:1px solid #eef6ff;padding:10px">${(document.getElementById('introCompose')?document.getElementById('introCompose').value:'') || ''}

${p1 || ''}

${p2 || ''}</textarea>

        <div style="margin-top:10px;display:flex;gap:8px;">
          <button class="blue-btn" onclick="completeTask()">Task Complete</button>
          <button class="blue-btn" style="background:#eef6ff;color:var(--royal)" onclick="editReview()">Edit</button>
        </div>

        <div id="completeArea" style="display:none;margin-top:12px;text-align:center;">
          <h4 style="color:var(--royal)">Task Complete ðŸŽ‰</h4>
          <div style="display:flex;gap:8px;justify-content:center;margin-top:8px;flex-wrap:wrap;">
            <a class="blue-btn" href="quiz.html">Take Quiz</a>
            <a class="blue-btn" href="teacher-report.html">Tutor Report</a>
            <button class="blue-btn" style="background:#eef6ff;color:var(--royal)" onclick="location.reload()">Return Home</button>
          </div>
        </div>
      `;
    } else {
      html = `<div>Unknown Step</div>`;
    }

    stepArea.innerHTML = html;
    attachStepHandlers();
  }

  // ---------- attach events for dynamic content ----------
  function attachStepHandlers(){
    // timer handlers look for elements only when step2 is active
    const timerDisp = document.getElementById('timerDisp');
    if(timerDisp) timerDisp.textContent = formatTime(timerS);

    // vocab
    const vocabGrid = document.getElementById('vocabGrid');
    if(vocabGrid) loadVocab();

    // previews if exist
    const preview1 = document.getElementById('preview1');
    if(preview1) preview1.value = buildP1Preview();
    const preview2 = document.getElementById('preview2');
    if(preview2) preview2.value = buildP2Preview();
  }

  // ---------- navigation ----------
  prevBtn.addEventListener('click', ()=> { if(step>1){ step--; render(); }});
  nextBtn.addEventListener('click', ()=> { if(step<7){ step++; render(); }});

  // ---------- timer functions ----------
  function startTimer(){
    if(timerInt) return;
    timerInt = setInterval(()=> {
      if(timerS<=0){ clearInterval(timerInt); timerInt=null; return; }
      timerS--; const disp = document.getElementById('timerDisp'); if(disp) disp.textContent = formatTime(timerS);
      if(timerS===0){ try{ new Audio('https://www.soundjay.com/buttons/sounds/beep-07.mp3').play(); }catch(e){} }
    },1000);
  }
  function pauseTimer(){ if(timerInt){ clearInterval(timerInt); timerInt=null; } }
  function resetTimer(){ pauseTimer(); timerS = 6*60; const disp = document.getElementById('timerDisp'); if(disp) disp.textContent = formatTime(timerS); }

  // ---------- vocab + speech ----------
  const defaultVocab = ['coherent','nuance','perspective','advocate','detrimental','substantial','mitigate','prevalent','compelling','anecdote'];
  function loadVocab(){
    const arr = JSON.parse(localStorage.getItem('ielts_vocab')||JSON.stringify(defaultVocab));
    const grid = document.getElementById('vocabGrid');
    grid.innerHTML = '';
    arr.forEach((w,i)=>{
      const node = document.createElement('div'); node.className='vocab-item';
      node.innerHTML = '<div style="font-weight:700;">'+escapeHtml(w)+'</div><div style="display:flex;gap:8px"><button class="blue-btn" style="background:#eef6ff;color:var(--royal)" onclick="speakWord(\''+escapeHtml(w)+'\')">ðŸ”Š</button><button onclick="removeVocab('+i+')" style="background:transparent;border:none;color:#c24b4b">âœ–</button></div>';
      grid.appendChild(node);
    });
  }
  function addVocab(){
    const val = document.getElementById('newWord').value.trim();
    if(!val) return;
    const arr = JSON.parse(localStorage.getItem('ielts_vocab')||JSON.stringify(defaultVocab));
    arr.unshift(val);
    localStorage.setItem('ielts_vocab', JSON.stringify(arr.slice(0,50)));
    loadVocab();
    document.getElementById('newWord').value = '';
  }
  function removeVocab(i){ const arr = JSON.parse(localStorage.getItem('ielts_vocab')||JSON.stringify(defaultVocab)); arr.splice(i,1); localStorage.setItem('ielts_vocab', JSON.stringify(arr)); loadVocab(); }

  function speakWord(w){
    const lang = document.getElementById('accent')?document.getElementById('accent').value:'en-GB';
    if(!('speechSynthesis' in window)){ alert('Speech synthesis not supported'); return; }
    window.speechSynthesis.cancel();
    const u = new SpeechSynthesisUtterance(w);
    u.lang = lang;
    u.rate = 0.98; u.pitch = 1;
    const voices = speechSynthesis.getVoices();
    const v = voices.find(x => x.lang && x.lang.toLowerCase().startsWith(u.lang.toLowerCase()));
    if(v) u.voice = v;
    speechSynthesis.speak(u);
  }

  // ---------- planners ----------
  function buildP1Preview(){
    const p = JSON.parse(localStorage.getItem('p1')||'{}');
    if(!p || (!p.mr && !p.sr && !p.ex)) return '';
    return 'Main reason: '+(p.mr||'')+'. Supporting: '+(p.sr||'')+'. Example: '+(p.ex||'')+'.';
  }
  function buildP2Preview(){
    const p = JSON.parse(localStorage.getItem('p2')||'{}');
    if(!p || (!p.mr && !p.sr && !p.ex)) return '';
    return 'Main reason: '+(p.mr||'')+'. Supporting: '+(p.sr||'')+'. Example: '+(p.ex||'')+'.';
  }
  function saveP1(){
    const mr = document.getElementById('mr1')?document.getElementById('mr1').value.trim():'';
    const sr = document.getElementById('sr1')?document.getElementById('sr1').value.trim():'';
    const ex = document.getElementById('ex1')?document.getElementById('ex1').value.trim():'';
    localStorage.setItem('p1', JSON.stringify({mr,sr,ex}));
    const pv = document.getElementById('preview1'); if(pv) pv.value = buildP1Preview();
  }
  function copyP1(){ const pv = document.getElementById('preview1'); if(pv) navigator.clipboard.writeText(pv.value||''); }

  function saveP2(){
    const mr = document.getElementById('mr2')?document.getElementById('mr2').value.trim():'';
    const sr = document.getElementById('sr2')?document.getElementById('sr2').value.trim():'';
    const ex = document.getElementById('ex2')?document.getElementById('ex2').value.trim():'';
    localStorage.setItem('p2', JSON.stringify({mr,sr,ex}));
    const pv = document.getElementById('preview2'); if(pv) pv.value = buildP2Preview();
  }
  function copyP2(){ const pv = document.getElementById('preview2'); if(pv) navigator.clipboard.writeText(pv.value||''); }

  // ---------- intro/concl helpers ----------
  function useIntro(){
    const t = 'In recent years, the issue has attracted significant attention...';
    const el = document.getElementById('introCompose');
    if(el) el.value = t + (el.value? '\n\n' + el.value : '');
    alert('Intro inserted');
  }
  function useConcl(){
    const t = 'In conclusion, the evidence suggests that...';
    const el = document.getElementById('introCompose');
    if(el) el.value = (el.value? el.value + '\n\n' : '') + t;
    alert('Conclusion inserted');
  }

  // ---------- complete / confetti ----------
  function completeTask(){
    document.getElementById('completeArea').style.display = 'block';
    confetti({ particleCount: 160, spread: 70, origin: { y: 0.4 } });
  }
  function editReview(){ step = 4; render(); }

  // ---------- helpers ----------
  function escapeHtml(s){ return String(s||'').replace(/[&<"'>]/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m])); }

  // ---------- init ----------
  (function init(){
    render();
    // allow arrow navigation
    document.addEventListener('keydown', (e)=>{ if(wizard.style.display!=='none'){ if(e.key==='ArrowLeft') prevBtn.click(); if(e.key==='ArrowRight') nextBtn.click(); } });
  })();
</script>

</body>
</html>
